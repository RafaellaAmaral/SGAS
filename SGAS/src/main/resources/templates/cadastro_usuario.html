<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="pt-br" >

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="/css/login.css">
  <link rel="shortcut icon" href="/images/iconesite.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
   <header id="header-login">
    <div class="logo">
		<a href="/">
      <img src="/images/patas.png" alt="Logo de pata Pet Amigo">
		</a>
      <h1>Pet Amigo</h1>
    </div>
  </header>
</head>

<header id="header-1">
    <nav>
      <a href="index.html">Home</a>
      <div class="dropdown">
        <a href="quero-adotar.html">Quero adotar</a>
		<div class="dropdown-content" sec:authorize="isAuthenticated()" >
		        <a href="/queroadotar">Adote</a>
		        <a href="/usuario/favoritos">Animais curtidos</a>
		      </div>
			  <div class="dropdown-content" sec:authorize="isAnonymous()" >
			          <a href="/queroadotar">Adote</a>
			          <a href="/login">Animais curtidos</a>
			        </div>
      </div>

      <div class="dropdown">
        <a href="#">Forma de ajudar</a>
        <div class="dropdown-content">
          <a href="/doacao">Fa칞a uma Doa칞칚o</a>
          <a href="/querovoluntariar">Seja volunt치rio</a>
        </div>
      </div>
      <a href="#">Fale conosco</a>
    </nav>
  </header>

<body>
      <main>
  <div class="container">
    <div class="form-box" id="cadastro-box">

        <h2>Cadastro</h2>
        <p class="subtitulo">Crie sua conta e ajude um pet 游</p>

        <form id="cadastroForm">
          <div class="campo">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
          </div>
          <div class="campo">
            <label for="email-cadastro">E-mail:</label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="campo">
            <label for="senha-cadastro">Senha:</label>
            <input type="password" id="senha" name="senha" minlength="6" required>
          </div>
          <div class="campo">
            <label for="confirma-senha">Confirme sua senha:</label>
            <input type="password" id="confirma-senha" name="confirmaSenha" required>
          </div>
          <div class="campo">
            <label for="endereco">Endere칞o (opcional):</label>
            <input type="text" id="endereco" name="endereco">
          </div>
          <div class="campo">
            <label for="telefone">Telefone (opcional):</label>
            <input type="tel" id="telefone" name="telefone">
          </div>
          <input type="hidden" name="isAdministrador" value="false">
          <button type="submit" class="btn">Cadastrar</button>
        </form>
        <p class="toggle">J치 tem cadastro? <a href="#" id="mostrar-login">Entrar</a></p>
      </div>
    </div>
  </main>

  <footer>
    <div class="sobre">
      <img src="/images/pata.png" alt="칈cone de pata">
      <p>Lorem Ipsum is simply dummy text.</p>
    </div>
    <div class="qrcode">
      <img src="/images/qrsgas.png" alt="QR Code para doa칞칚o" id="qr-code">
      <button>SitePetAmigo.br</button>
    </div>
    <div class="contato">
      <h3>Contato</h3>
      <p><img src="/images/icone-wpp.webp" alt="Whatsapp"> (31) 98528-6875</p>
      <p><img src="/images/paw-print.png" alt="Email"> cachorros123@gmail.com</p>
    </div>
    <div class="coracao">
      <img src="/images/transferir.webp" alt="Cora칞칚o com pata">
    </div>
  </footer>

  <script>
    const form = document.getElementById('cadastroForm');
    const mostrarLogin = document.getElementById('mostrar-login');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const senha = document.getElementById('senha').value;
      const confirma = document.getElementById('confirma-senha').value;

      const msgEl = document.querySelector('#cadastro-box .mensagem');
      if (senha !== confirma) {
        showMessage('As senhas n칚o conferem.', true);
        return;
      }

      const payload = { nome, email, senha, isAdministrador: false };

      try {
        const res = await fetch('/usuario/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const body = await res.json().catch(() => ({}));
       if (res.ok) {
        showMessage('Cadastro realizado com sucesso! Redirecionando...', false);
       form.reset();
         setTimeout(() => {
        window.location.href = "/login"; // ajuste para sua p치gina real de login
        }, 1500);

        } else if (res.status === 409) {
          showMessage(body.error || 'E-mail j치 cadastrado.', true);
        } else if (res.status === 400) {
          showMessage(JSON.stringify(body), true);
        } else {
          showMessage(body.error || 'Erro ao cadastrar usu치rio.', true);
        }
      } catch (err) {
        showMessage('Falha de rede ou servidor.', true);
      }
    });

    function showMessage(text, isError = false) {
      let el = document.querySelector('#cadastro-box .mensagem');
      if (!el) {
        el = document.createElement('div');
        el.className = 'mensagem';
        document.querySelector('#cadastro-box').appendChild(el);
      }
      el.textContent = text;
      el.style.color = isError ? 'crimson' : 'green';
    }
  </script>
</body>

</html>